Выполненное задание. 
Надеюсь все понял правильно, хотя во время выполнения были вопросы по формулировки
Прикрепил 2 файла с исходными данными, также промежуточный файл для самопроверки. 
